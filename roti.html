<!doctype html>

<html lang="en">
<head>
	<meta charset="utf-8">

	<title>rôti</title>
	<link rel="stylesheet" href="font-awesome-4.6.3/css/font-awesome.min.css">
	<meta name="description" content="La rôtisserie en ligne">
	<meta name="author" content="Des gens rôti">
	<link href='https://fonts.googleapis.com/css?family=Noto+Sans:400,700' rel='stylesheet' type='text/css'>

	<!--Import Google Icon Font-->
     <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
     <!--Import materialize.css-->
     <link type="text/css" rel="stylesheet" href="materialize/css/materialize.min.css"  media="screen,projection"/>

     <!--Let browser know website is optimized for mobile-->
     <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

	<link rel="stylesheet" href="roti.css">

	<link rel="apple-touch-icon-precomposed" sizes="57x57" href="favicon/apple-touch-icon-57x57.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="favicon/apple-touch-icon-114x114.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="favicon/apple-touch-icon-72x72.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="favicon/apple-touch-icon-144x144.png" />
	<link rel="apple-touch-icon-precomposed" sizes="60x60" href="favicon/apple-touch-icon-60x60.png" />
	<link rel="apple-touch-icon-precomposed" sizes="120x120" href="favicon/apple-touch-icon-120x120.png" />
	<link rel="apple-touch-icon-precomposed" sizes="76x76" href="favicon/apple-touch-icon-76x76.png" />
	<link rel="apple-touch-icon-precomposed" sizes="152x152" href="favicon/apple-touch-icon-152x152.png" />
	<link rel="icon" type="image/png" href="favicon/favicon-196x196.png" sizes="196x196" />
	<link rel="icon" type="image/png" href="favicon/favicon-96x96.png" sizes="96x96" />
	<link rel="icon" type="image/png" href="favicon/favicon-32x32.png" sizes="32x32" />
	<link rel="icon" type="image/png" href="favicon/favicon-16x16.png" sizes="16x16" />
	<link rel="icon" type="image/png" href="favicon/favicon-128.png" sizes="128x128" />
	<meta name="application-name" content="&nbsp;"/>
	<meta name="msapplication-TileColor" content="#FFFFFF" />
	<meta name="msapplication-TileImage" content="favicon/mstile-144x144.png" />
	<meta name="msapplication-square70x70logo" content="favicon/mstile-70x70.png" />
	<meta name="msapplication-square150x150logo" content="favicon/mstile-150x150.png" />
	<meta name="msapplication-wide310x150logo" content="favicon/mstile-310x150.png" />
	<meta name="msapplication-square310x310logo" content="favicon/mstile-310x310.png" />

	


  <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>

<body>

	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="materialize/js/materialize.min.js"></script>

	<div class="container">
		<div class="center-block">
			<div class="flip-container" onclick='turn()';>
				<div class="flipper" id="flip">
					<div class="front" id="front">
						<div class="card suitregle">
							<p> <b>Règles</b> : Chaque rôti tire une carte à tour de role dans le sens des aiguilles d'une montre.
								
				   			</p>
						</div>
					</div>

					<div class="back" id="back">
						<div class="card suitregle">
							<p> Un <i class="fa fa-beer" aria-hidden="true"></i> indique un shot de boisson. Chaqu'un est libre de boire ce qu'il veut, du moment que ça rend rôti. <br/> <b> Bon Rôtissage !</b>
				   			</p>
						</div>
					</div>


				</div>
			</div>
		</div>	

		<div class="center-item">
			<a class="waves-effect waves-light btn green lighten-1" onclick='turn();'>rôti-moi ! </a>
		</div>

		<div class="modal" id="deckend">
    <div class="modal-content">
      <h4>Fin du deck ! </h4>
      <p>Tout le monde perd son rôle et toutes les règles sont annulés ! C'est reparti pour un tour !</p>
    </div>
    <div class="modal-footer">
      <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Let's rôti !</a>
    </div>

		</div>

	</div>

	<script type="text/javascript">
	var count = 1;
	var block = false;

	var json = [];
	var total_cards = [];
	var deck = [];

	var joueurs = ["Bob", "Alice", "Marcus", "ClapTrap"];

	var getUrlParameter = function getUrlParameter(sParam) {
	    var sPageURL = decodeURIComponent(window.location.search.substring(1)),
	        sURLVariables = sPageURL.split('&'),
	        sParameterName,
	        i;

	    for (i = 0; i < sURLVariables.length; i++) {
	        sParameterName = sURLVariables[i].split('=');

	        if (sParameterName[0] === sParam) {
	            return sParameterName[1] === undefined ? true : sParameterName[1];
	        }
	    }
	};
	// Charger le fichier de cartes 
	// TODO : Chargher le nom du fichier à partir de la bare d'adresse

	file = getUrlParameter("deck");
	if (!file)
	{
		file = "template.json"
	}
	 $.getJSON(file, function(data)
	 	{
	 		json = data;
	 		total_cards = json.cards;
	 		deck = total_cards.slice();

	 	});

	 var showModalNextTurn = false;

		function turn(){

			// Attentre que block soit dispo (pour eviter de tourner plusieurs cartes en même temps)
			if (!block)
			{
				block = true;
				if (showModalNextTurn == true)
				{
					$("#deckend").openModal();
					showModalNextTurn = false;
				}

				// Si le deck est vide, le recharger
			  	if (deck.length == 0)
			  	{
			  		deck = total_cards.slice();
			  		showModalNextTurn = true;
			  	}


				// Faire tourner la carte
			  $("#flip").addClass('rotate');


			  // Attendre la fin de l'animation
			  $("#flip").one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend',   
			  function(e) {

			  	// Copier la carte au back sur le front
			  	$("#front").html($("#back").html());

				// Enlever la rotation (la carte front repasse devant)
			  	$("#flip").removeClass('rotate');

			  	// Charger ici le back de la prochaine carte à jouer (back)
			  	var id = Math.floor((Math.random() * (deck.length)));

			  	// Enlever les classe de la carte du back pour pouvoir les recharger en fonction de ce qu'il y a dans le json
			  	$("#back .card").removeClass().addClass("card");

			  	// Si la carte à un type, le charger
			  	if (deck[id].type)
			  	{
			  		$("#back .card").addClass("suit"+deck[id].type);
			  	}


			  	// Charger le texte de la carte
			  	var txt = deck[id].content;

			  	var joueursTmp = joueurs.slice();
			  	var random = 0;
			  	// Patterns !
			  	// Définition des parterns : {lePattern}
			  	var personne = [];
			  	for(var i =0; i<3; i++)
			  	{
			  		random = Math.floor((Math.random() * (joueursTmp.length)));

			  		personne[i] = joueursTmp[random];
			  		joueursTmp.splice(random);

			  	}

			  	txt = txt.replace(/{j1}/i, personne[0]);
			  	txt = txt.replace(/{j2}/i, personne[1]);
			  	txt = txt.replace(/{j3}/i, personne[2]);



			  	$("#back .card p ").html(txt);

			  	// Enlever la carte du deck
			  	deck.splice(id,1);

			  	block = false;
				});
			}


		};

	</script>

</body>



</html>